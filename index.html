<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Algorithmic Conscience</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .bouncing-image {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased p-4 sm:p-8">

    <header class="text-center mb-8">
        <div class="flex flex-col items-center justify-center">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600">
                The Algorithmic Conscience
            </h1>
        </div>
        <p class="mt-2 text-sm sm:text-base text-gray-400 max-w-xl mx-auto">
            An ethical and cognitive auditor for high-stakes conversations.
        </p>
    </header>

    <main class="flex flex-col lg:flex-row gap-8 flex-1">
        <div class="panel bg-gray-800 p-6 rounded-2xl shadow-lg flex-1">
            <h2 class="text-xl font-bold mb-4 text-center">Transcript Input</h2>
            <textarea
                id="textInput"
                class="w-full h-80 bg-gray-700 rounded-xl p-4 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all resize-none placeholder-gray-400"
                placeholder="Paste your meeting transcript or conversation here..."
            ></textarea>
            <div class="mt-6 flex justify-center space-x-4">
                <button
                    id="analyzeButton"
                    class="flex-1 max-w-[150px] py-3 rounded-full font-bold transition-all duration-200 bg-blue-600 hover:bg-blue-700"
                >
                    Analyze Text
                </button>
                <button
                    id="uploadButton"
                    class="flex-1 max-w-[150px] py-3 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-full transition-colors"
                >
                    Upload .txt/.md File
                </button>
                <input
                    type="file"
                    id="fileInput"
                    accept=".txt,.md"
                    style="display: none;"
                >
            </div>
            <div id="error-message" class="mt-4 text-center text-red-400 font-medium" style="display:none;"></div>
        </div>

        <div class="panel bg-gray-800 p-6 rounded-2xl shadow-lg flex-1 flex flex-col">
            <div class="flex flex-col items-center justify-center mb-4">
                <h2 class="text-xl font-bold">Cognitive Dashboard</h2>
                <span id="biasCount" class="text-4xl font-extrabold mt-2 text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-yellow-400">0</span>
                <span class="text-sm font-semibold text-gray-400">Biases Detected</span>
            </div>
            <div id="dashboard-content" class="dashboard-content flex-1 overflow-y-auto space-y-4">
                <div id="placeholder" class="flex items-center justify-center h-full text-center p-8">
                    <p class="text-gray-400">Insights will appear here after analysis.</p>
                </div>
                <div id="loading-spinner" class="flex flex-col items-center justify-center p-8 bg-gray-700 rounded-xl hidden">
                    <div class="spinner mb-2"></div>
                    <span class="text-sm text-blue-400">Analyzing...</span>
                </div>
            </div>
        </div>
    </main>

  <script>
    const MODEL_NAME = "openai/gpt-oss-20b:free";

    const systemInstruction = `You are a professional Cognitive Auditor AI, a silent partner for high-stakes decisions.
Your task is to analyze a meeting transcript to identify specific cognitive biases, logical fallacies, and ethical blind spots.

Analyze the transcript for the following issues:
- Biases from Too Much Information: Anchoring Bias, Conservatism Bias, Curse of Knowledge, Decoy Effect, Framing Effect, Hindsight Bias, Pro-innovation Bias.
- Biases from Not Enough Meaning: Bikeshedding, Clustering Illusion, Confabulation, Gambler's Fallacy, Over-generalization.
- Biases from the Need to Act Fast: Apophenia, Availability Heuristic, Dunning-Kruger Effect, Halo Effect, Omission Bias.
- Biases from What We Should Remember: Actor-Observer Bias, Ben Franklin Effect, Bizarreness Effect, Humor Effect, Peak-End Rule, Stereotypical Bias.
- Group Dynamics: Groupthink, Bandwagon Effect, Illusion of Truth.

If you identify a potential issue, respond with a JSON object for each one with the keys 'type', 'observation', and 'implication'.
If no issues are detected, respond with an empty JSON object {}. Respond only with valid JSON. Do not include commentary or markdown formatting.`;

    const textInput = document.getElementById('textInput');
    const analyzeButton = document.getElementById('analyzeButton');
    const uploadButton = document.getElementById('uploadButton');
    const fileInput = document.getElementById('fileInput');
    const dashboardContent = document.getElementById('dashboard-content');
    const loadingSpinner = document.getElementById('loading-spinner');
    const errorMessage = document.getElementById('error-message');
    const placeholder = document.getElementById('placeholder');
    const biasCount = document.getElementById('biasCount');

    function setLoading(isLoading) {
        if (isLoading) {
            analyzeButton.textContent = 'Analyzing...';
            analyzeButton.disabled = true;
            analyzeButton.classList.add('bg-gray-600', 'cursor-not-allowed');
            analyzeButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            loadingSpinner.classList.remove('hidden');
            placeholder.classList.add('hidden');
            errorMessage.style.display = 'none';
            biasCount.textContent = '...';
        } else {
            analyzeButton.textContent = 'Analyze Text';
            analyzeButton.disabled = false;
            analyzeButton.classList.remove('bg-gray-600', 'cursor-not-allowed');
            analyzeButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
            loadingSpinner.classList.add('hidden');
        }
    }

    function displayInsights(insights) {
        dashboardContent.innerHTML = '';
        biasCount.textContent = insights.length;

        if (insights.length > 0) {
            insights.forEach(insight => {
                const insightItem = document.createElement('div');
                insightItem.className = "bg-gray-700 p-4 rounded-xl shadow-inner border border-gray-600 space-y-2 hover:bg-gray-600 transition-colors duration-200";
                insightItem.innerHTML = `
                    <div class="flex justify-between items-center text-sm font-semibold text-blue-400">
                        <span>${insight.type}</span>
                        <span class="text-gray-400">${new Date().toISOString().substr(11, 8)}</span>
                    </div>
                    <p class="text-gray-300 text-sm"><strong>Observation:</strong> ${insight.observation}</p>
                    <p class="text-gray-400 text-sm"><strong>Implication:</strong> ${insight.implication}</p>
                `;
                dashboardContent.appendChild(insightItem);
            });
        } else {
            const message = document.createElement('p');
            message.className = "text-gray-400 text-center p-8";
            message.textContent = "Analysis complete, no issues detected.";
            dashboardContent.appendChild(message);
        }
    }

    async function analyzeText(text) {
        errorMessage.style.display = 'none';

        if (!text.trim()) {
            errorMessage.textContent = 'Please enter some text or upload a file to analyze.';
            errorMessage.style.display = 'block';
            return;
        }

        setLoading(true);

        const payload = {
            model: MODEL_NAME,
            messages: [
                { role: "system", content: systemInstruction },
                { role: "user", content: text }
            ]
        };

        try {
            const response = await fetch("/api/analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            const resultText = result?.choices?.[0]?.message?.content;

            if (!resultText) {
                errorMessage.textContent = "The API did not return a valid response.";
                errorMessage.style.display = 'block';
                return;
            }

            const cleanedText = resultText
                .replace(/```json\s*|```/g, '')
                .replace(/[\u0000-\u001F]+/g, '')
                .trim();

            let insights = [];

            try {
                const parsed = JSON.parse(cleanedText);

                if (Array.isArray(parsed)) {
                    insights = parsed.filter(item =>
                        item && typeof item === 'object' && item.type && item.observation && item.implication
                    );
                } else if (typeof parsed === 'object' && parsed !== null) {
                    if (parsed.type && parsed.observation && parsed.implication) {
                        insights = [parsed];
                    }
                }
            } catch (err) {
                console.error("Parsing failed:", err, "Raw response:", resultText);
                errorMessage.textContent = "The response wasn't valid JSON. Try simplifying your input or rephrasing.";
                errorMessage.style.display = 'block';
                return;
            }

            displayInsights(insights);

        } catch (error) {
            console.error("Error analyzing text:", error);
            errorMessage.textContent = 'Something went wrong while analyzing. Please try again.';
            errorMessage.style.display = 'block';
        } finally {
            setLoading(false);
        }
    }

    analyzeButton.addEventListener('click', () => analyzeText(textInput.value));
    uploadButton.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (event) => {
        const file = event.target.files?.[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const text = e.target.result;
                textInput.value = text;
                analyzeText(text);
            };
            reader.readAsText(file);
        }
    });
</script>


</body>
</html>






